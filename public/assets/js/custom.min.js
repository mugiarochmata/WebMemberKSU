$(document).ready(function(){
    $("#productSavingId").change(function(event){
        event.preventDefault();
        // $.ajaxSetup({
        //     headers: {
        //         'X-XSRF-TOKEN': $('input[name="_token"]').val()
        //     }
        // });
        let memberId = $("input[name=memberId]").val();
        let productSavingId = $("#productSavingId").val();
        
        let _token   = $('input[name="_token"]').val();
       // alert(productSavingId);
        $.ajax({
          url: "getmembersaving",
          type:"POST",
          data:{
            memberId:memberId,
            productSavingId:productSavingId,
            _token: _token
          },
          success:function(response){
            console.log(response);
            if(response=='Data tidak ditemukan') {
                $('.error').text(response);
                $('span#productSavingId').html('-');
                $('span#memberId').html( '-' );
                $('span#memberName').html( '-' );
                $('span#productSavingDescription').html( '-' );
                $('span#defaultAmount').html( '-' );
             
            }else{
                $('input#memberId').val( memberId );
                $('input#productSavingId').val( productSavingId );
                $('span#productSavingId').html( productSavingId );
                $('span#memberId').html( response.memberId );
                $('span#memberName').html( response.memberName );
                $('span#productSavingDescription').html( response.productSavingDescription );
                $('span#defaultAmount').html( response.defaultAmount );
                
            }
          },
         });
    });

    $(".find-data-simpanan").click(function(event){
      event.preventDefault();
     
      let memberId = $("input[name=memberId]").val();
      let productSavingId = $("#productSavingId").val();
      
      let _token   = $('input[name="_token"]').val();
     // alert(productSavingId);
      $.ajax({
        url: "getmembersavinglist",
        type:"POST",
        data:{
          memberId:memberId,
          _token: _token
        },
        success:function(response){
          console.log(response);
          if(response=='Data tidak ditemukan') {
              

              $('.error').text(response);
           
          }else{
              $('input#memberId').val( memberId );
              var x=4;
              $('#table_data').empty();
              $.each(response, function( index, value ) {
                  
                 
                  var html = '<tr>';
                  html += '<td>'+x+'</td>';
                  html += '<td><input type="hidden" name="savingId'+index+'" id="savingId'+index+'" value="'+value.savingId+'" />'+value.savingId+'</td>';
                  html += '<td><input type="hidden" name="productSavingId'+index+'" id="productSavingId'+index+'" value="'+value.productSavingId+'" /><input type="hidden" name="productSavingName'+index+'" id="productSavingName'+index+'" value="'+value.productSavingName+'" />'+value.productSavingName+'</td>';
                  html += '<td><h5 class="font-size-14 mb-1"><input type="hidden" name="memberName'+index+'" id="memberName'+index+'" value="'+value.memberName+'"/><a href="#" class="text-dark">'+value.memberName+'</a></h5><p class="text-muted mb-0"><input type="hidden" name="memberId'+index+'" id="memberId'+index+'" value="'+value.memberId+'"/>'+value.memberId+'</p></td>';
                  html += '<td class="text-right"><input type="hidden" name="balanceAmount'+index+'" id="balanceAmount'+index+'" value="'+value.balanceAmount+'" />'+value.balanceAmount+'</td>';
                  html += '<td class="text-center"><input type="hidden" name="savingStatusName'+index+'" id="savingStatusName'+index+'" value="'+value.savingStatusName+'" /><span class="badge badge-pill badge-soft-success font-size-11">'+value.savingStatusName+'</span></td>';
                  html += '<td class="text-center"><div class="btn-group"><button class="btn btn-primary find-data-detail-simpanan" onclick="getDetail('+index+')">Tarik</button></div></td></tr>';
                  
                  $('#table_data').prepend(html);
                  x=x-1;
                  console.log( value.savingId );
                });
              
          }
        },
       });
    });

    $("select[name='productLoanId']").change(function(){
      var productLoanId = $(this).val();
      console.log(productLoanId);
      if(productLoanId == 'PL004' || productLoanId == 'PL007'){
          $('#mpp').show();
          $('#elektronik').hide();
          $('#pendidikan').hide();
          $('#kendaraan').hide();
      }else if(productLoanId == 'PL002'){
          $('#mpp').hide();
          $('#elektronik').show();
          $('#pendidikan').hide();
          $('#kendaraan').hide();
      }else if(productLoanId == 'PL008'){
          $('#mpp').hide();
          $('#elektronik').hide();
          $('#pendidikan').show();
          $('#kendaraan').hide();
      }else if(productLoanId == 'PL009'){
          $('#mpp').hide();
          $('#elektronik').hide();
          $('#pendidikan').hide();
          $('#kendaraan').show();
      }else{
          $('#mpp').hide();
          $('#elektronik').hide();
          $('#pendidikan').hide();
          $('#kendaraan').hide();
          console.log('kosong');
      }
      $.getJSON("getproductloankind/"+productLoanId, function(return_data){
          $("#productLoanKindId").empty();
          $("#productLoanKindId").append(
          
              "<option value=''>Pilih Jenis Pinjaman</option>"
              
              );
          $.each(return_data, function(key,value){
              
          
          $("#productLoanKindId").append(
          
          "<option value=" + value.id +">"+value.name+"</option>"
          
          );
          });
          });
    });
});